# SpreadCheetah

SpreadCheetah is a high-performance .NET library for generating spreadsheet (Microsoft Excel XLSX) files.

| Package | Latest version | Description |
| ------- | -------------- | ----------- |
| `SpreadCheetah` | [![Nuget](https://img.shields.io/nuget/v/SpreadCheetah)](https://www.nuget.org/packages/SpreadCheetah) | Main package for using SpreadCheetah.
| `SpreadCheetah.SourceGenerator` | [![Nuget](https://img.shields.io/nuget/v/SpreadCheetah.SourceGenerator)](https://www.nuget.org/packages/SpreadCheetah.SourceGenerator) | Experimental extension based on [C# Source Generators](https://devblogs.microsoft.com/dotnet/introducing-c-source-generators).


## Features
- Performance (see benchmarks below)
- Low memory allocation (see benchmarks below)
- Async APIs
- No dependency to Microsoft Excel
- Targeting .NET Standard 2.0 (for .NET Framework 4.6.1 and later)
- Free and open source!

SpreadCheetah is designed to create spreadsheet files in a forward-only manner.
That means worksheets from left to right, rows from top to bottom, and row cells from left to right.
This allows for creating spreadsheet files in a streaming manner, while also keeping a low memory footprint.

Styling support is currently very limited, and formulas are not yet supported. This is planned for future releases.

## How to install
SpreadCheetah is available as a [NuGet package](https://www.nuget.org/packages/SpreadCheetah). The NuGet package targets both .NET Standard 2.0 and .NET Standard 2.1.
The .NET Standard 2.0 version is just intended for backwards compatibility (.NET Framework and earlier versions of .NET Core). Use the .NET Standard 2.1 version to achieve the best performance (.NET Core 3.0+ and .NET 5.0+).


## Basic usage
```cs
using (var spreadsheet = await Spreadsheet.CreateNewAsync(stream))
{
    // A spreadsheet must contain at least one worksheet.
    await spreadsheet.StartWorksheetAsync("Sheet 1");

    // Cells are inserted row by row.
    var row = new List<DataCell>();
    row.Add(new DataCell("Answer to the ultimate question:"));
    row.Add(new DataCell(42));

    // Rows are inserted from top to bottom.
    await spreadsheet.AddRowAsync(row);

    // Remember to call Finish before disposing.
    // This is important to properly finalize the XLSX file.
    await spreadsheet.FinishAsync();
}
```

## The Source Generator extension
[Source Generators](https://devblogs.microsoft.com/dotnet/introducing-c-source-generators) is a newly released feature in the C# compiler. The experimental Source Generator extension for SpreadCheetah makes it easier to create a row from an object. It adds the method `AddAsRowAsync()`, and by calling the method with your own custom type, the generator will analyze the type and create an implementation of the method. The value of each property with a public getter will become the value of a cell in the row. Here is an example:
```cs
// A plain C# class with public getters. Structs and C# 9.0 records are also supported.
public class MyObject
{
    public string Question { get; set; }
    public int Answer { get; set; }
}
```

```cs
// Create an object of the class.
var myObject = new MyObject
{
    Question = "Answer to the ultimate question:",
    Answer = 42
};

using var spreadsheet = await Spreadsheet.CreateNewAsync(stream);

await spreadsheet.StartWorksheetAsync("Sheet 1");

// The implementation of this method will be generated by the source generator.
await spreadsheet.AddAsRowAsync(myObject);

await spreadsheet.FinishAsync();
```

## Benchmarks
The benchmark results here have been collected using [Benchmark.NET](https://github.com/dotnet/benchmarkdotnet) with the following system configuration:

``` ini
BenchmarkDotNet=v0.13.1, OS=Windows 10.0.19043.1165 (21H1/May2021Update)
Intel Core i5-8600K CPU 3.60GHz (Coffee Lake), 1 CPU, 6 logical and 6 physical cores
.NET SDK=6.0.100-preview.7.21379.14
  [Host]             : .NET 6.0.0 (6.0.21.37719), X64 RyuJIT
  .NET 6.0           : .NET 6.0.0 (6.0.21.37719), X64 RyuJIT
  .NET Core 3.1      : .NET Core 3.1.18 (CoreCLR 4.700.21.35901, CoreFX 4.700.21.36305), X64 RyuJIT
  .NET Framework 4.8 : .NET Framework 4.8 (4.8.4400.0), X64 RyuJIT

InvocationCount=1  UnrollFactor=1  
```

The code executed in the benchmark creates a worksheet of 20 000 rows and 10 columns filled with string values. The same use case has been implemented in other spreadsheet libraries for comparison.


### .NET Framework 4.8

|                    Library |         Mean |        Error |       StdDev |  Allocated |
|----------------------------|-------------:|-------------:|-------------:|-----------:|
|          **SpreadCheetah** | **64.36 ms** | **0.072 ms** | **0.064 ms** | **152 KB** |
|    Open XML (SAX approach) |    400.71 ms |     0.455 ms |     0.380 ms |  35 485 KB |
|                  EPPlus v4 |    591.03 ms |     9.409 ms |     8.801 ms | 286 367 KB |
|    Open XML (DOM approach) |    843.70 ms |     4.120 ms |     3.216 ms | 135 835 KB |
|                  ClosedXML |  2,181.33 ms |    10.425 ms |     9.751 ms | 556 917 KB |


### .NET Core 3.1

|                    Library |         Mean |        Error |       StdDev |  Allocated |
|----------------------------|-------------:|-------------:|-------------:|-----------:|
|          **SpreadCheetah** | **34.07 ms** | **0.180 ms** | **0.160 ms** |  **53 KB** |
|    Open XML (SAX approach) |    235.70 ms |     0.875 ms |     0.819 ms |  58 244 KB |
|                  EPPlus v4 |    473.14 ms |     7.686 ms |     7.189 ms | 216 130 KB |
|    Open XML (DOM approach) |    689.44 ms |     9.184 ms |     8.591 ms | 158 084 KB |
|                  ClosedXML |  1,959.02 ms |    16.269 ms |    15.218 ms | 529 764 KB |


### .NET 6 Preview 7

|                    Library |         Mean |        Error |       StdDev |  Allocated |
|----------------------------|-------------:|-------------:|-------------:|-----------:|
|          **SpreadCheetah** | **29.87 ms** | **0.043 ms** | **0.036 ms** |   **6 KB** |
|    Open XML (SAX approach) |    201.42 ms |     0.792 ms |     0.741 ms |  58 235 KB |
|                  EPPlus v4 |    398.64 ms |     5.165 ms |     4.579 ms | 195 793 KB |
|    Open XML (DOM approach) |    568.19 ms |    11.192 ms |    14.155 ms | 158 116 KB |
|                  ClosedXML |  1,686.36 ms |    15.595 ms |    14.588 ms | 518 731 KB |