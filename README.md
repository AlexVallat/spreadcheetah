# SpreadCheetah

SpreadCheetah is a high-performance .NET library for generating spreadsheet (Microsoft Excel XLSX) files.

| Package | Latest version | Description |
| ------- | -------------- | ----------- |
| `SpreadCheetah` | [![Nuget](https://img.shields.io/nuget/v/SpreadCheetah)](https://www.nuget.org/packages/SpreadCheetah) | Main package for using SpreadCheetah.
| `SpreadCheetah.SourceGenerator` | [![Nuget](https://img.shields.io/nuget/v/SpreadCheetah.SourceGenerator)](https://www.nuget.org/packages/SpreadCheetah.SourceGenerator) | Experimental extension based on [C# Source Generators](https://devblogs.microsoft.com/dotnet/introducing-c-source-generators).


## Features
- Performance (see benchmarks below)
- Low memory allocation (see benchmarks below)
- Async APIs
- No dependency to Microsoft Excel
- Targeting .NET Standard 2.0 (for .NET Framework 4.6.1 and later)
- Free and open source!

SpreadCheetah is designed to create spreadsheet files in a forward-only manner.
That means worksheets from left to right, rows from top to bottom, and row cells from left to right.
This allows for creating spreadsheet files in a streaming manner, while also keeping a low memory footprint.

Most basic spreadsheet functionality is supported, such as cells with different data types, basic styling, and formulas. More advanced functionality is planned for future releases.

## How to install
SpreadCheetah is available as a [NuGet package](https://www.nuget.org/packages/SpreadCheetah). The NuGet package targets both .NET Standard 2.0 and .NET Standard 2.1.
The .NET Standard 2.0 version is just intended for backwards compatibility (.NET Framework and earlier versions of .NET Core). Use the .NET Standard 2.1 version to achieve the best performance (.NET Core 3.0+ and .NET 5.0+).


## Basic usage
```cs
using (var spreadsheet = await Spreadsheet.CreateNewAsync(stream))
{
    // A spreadsheet must contain at least one worksheet.
    await spreadsheet.StartWorksheetAsync("Sheet 1");

    // Cells are inserted row by row.
    var row = new List<Cell>();
    row.Add(new Cell("Answer to the ultimate question:"));
    row.Add(new Cell(42));

    // Rows are inserted from top to bottom.
    await spreadsheet.AddRowAsync(row);

    // Remember to call Finish before disposing.
    // This is important to properly finalize the XLSX file.
    await spreadsheet.FinishAsync();
}
```

### Other examples
- [Writing to a file](https://github.com/sveinungf/spreadcheetah-samples/blob/main/SpreadCheetahSamples/SpreadCheetahSamples/WriteToFile.cs)
- [Styling basics](https://github.com/sveinungf/spreadcheetah-samples/blob/main/SpreadCheetahSamples/SpreadCheetahSamples/StylingBasics.cs)
- [Formula basics](https://github.com/sveinungf/spreadcheetah-samples/blob/main/SpreadCheetahSamples/SpreadCheetahSamples/FormulaBasics.cs)
- [Performance tips](https://github.com/sveinungf/spreadcheetah-samples/blob/main/SpreadCheetahSamples/SpreadCheetahSamples/PerformanceTips.cs)

## The Source Generator extension
[Source Generators](https://devblogs.microsoft.com/dotnet/introducing-c-source-generators) is a newly released feature in the C# compiler. The experimental Source Generator extension for SpreadCheetah makes it easier to create a row from an object. It adds the method `AddAsRowAsync()`, and by calling the method with your own custom type, the generator will analyze the type and create an implementation of the method. The value of each property with a public getter will become the value of a cell in the row. Here is an example:
```cs
// A plain C# class with public getters. Structs and C# 9.0 records are also supported.
public class MyObject
{
    public string Question { get; set; }
    public int Answer { get; set; }
}
```

```cs
// Create an object of the class.
var myObject = new MyObject
{
    Question = "Answer to the ultimate question:",
    Answer = 42
};

using var spreadsheet = await Spreadsheet.CreateNewAsync(stream);

await spreadsheet.StartWorksheetAsync("Sheet 1");

// The implementation of this method will be generated by the source generator.
await spreadsheet.AddAsRowAsync(myObject);

await spreadsheet.FinishAsync();
```

## Benchmarks
The benchmark results here have been collected using [Benchmark.NET](https://github.com/dotnet/benchmarkdotnet) with the following system configuration:

``` ini
BenchmarkDotNet=v0.13.1, OS=Windows 10.0.19043.1288 (21H1/May2021Update)
Intel Core i5-8600K CPU 3.60GHz (Coffee Lake), 1 CPU, 6 logical and 6 physical cores
.NET SDK=6.0.100-rc.2.21505.57
  [Host]             : .NET 6.0.0 (6.0.21.48005), X64 RyuJIT
  .NET 6.0           : .NET 6.0.0 (6.0.21.48005), X64 RyuJIT
  .NET Core 3.1      : .NET Core 3.1.20 (CoreCLR 4.700.21.47003, CoreFX 4.700.21.47101), X64 RyuJIT
  .NET Framework 4.8 : .NET Framework 4.8 (4.8.4420.0), X64 RyuJIT

InvocationCount=1  UnrollFactor=1
```

The code executed in the benchmark creates a worksheet of 20 000 rows and 10 columns filled with string values. The same use case has been implemented in other spreadsheet libraries for comparison.
Some of these libraries have multiple ways of achieving the same result, but to make this a fair comparison the idea is to use the most efficient approach for each library. The code is available [here](https://github.com/sveinungf/spreadcheetah/blob/main/SpreadCheetah.Benchmark/Benchmarks/StringCells.cs).


### .NET Framework 4.8

|                    Library |         Mean |        Error |       StdDev |  Allocated |
|----------------------------|-------------:|-------------:|-------------:|-----------:|
|          **SpreadCheetah** | **64.36 ms** | **0.072 ms** | **0.064 ms** | **152 KB** |
|    Open XML (SAX approach) |    400.71 ms |     0.455 ms |     0.380 ms |  35 485 KB |
|                  EPPlus v4 |    591.03 ms |     9.409 ms |     8.801 ms | 286 367 KB |
|    Open XML (DOM approach) |    843.70 ms |     4.120 ms |     3.216 ms | 135 835 KB |
|                  ClosedXML |  2,181.33 ms |    10.425 ms |     9.751 ms | 556 917 KB |


### .NET Core 3.1

|                    Library |         Mean |        Error |       StdDev |  Allocated |
|----------------------------|-------------:|-------------:|-------------:|-----------:|
|          **SpreadCheetah** | **34.22 ms** | **0.231 ms** | **0.216 ms** |  **53 KB** |
|    Open XML (SAX approach) |    238.03 ms |     1.449 ms |     1.355 ms |  58 243 KB |
|                  EPPlus v4 |    463.71 ms |     2.204 ms |     1.721 ms | 216 127 KB |
|    Open XML (DOM approach) |    684.81 ms |     5.108 ms |     4.528 ms | 158 087 KB |
|                  ClosedXML |  1,912.72 ms |    11.683 ms |    10.928 ms | 529 764 KB |


### .NET 6 Release Candidate 2

|                    Library |         Mean |        Error |       StdDev |  Allocated |
|----------------------------|-------------:|-------------:|-------------:|-----------:|
|          **SpreadCheetah** | **29.82 ms** | **0.038 ms** | **0.034 ms** |   **6 KB** |
|    Open XML (SAX approach) |    193.82 ms |     0.866 ms |     0.768 ms |  58 239 KB |
|                  EPPlus v4 |    397.18 ms |     5.775 ms |     5.402 ms | 195 793 KB |
|    Open XML (DOM approach) |    564.94 ms |    11.278 ms |    16.175 ms | 158 082 KB |
|                  ClosedXML |  1,642.94 ms |    13.094 ms |    12.249 ms | 518 732 KB |
